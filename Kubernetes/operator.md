# Kubernetes Operator

## Reference
* [Kubernetes Operator とは redhat.com](https://www.redhat.com/ja/topics/containers/what-is-a-kubernetes-operator)

## Kubernetes Operator とは
Operator (カスタムコントローラー) はカスタムリソースを使用する Kubernetes へのソフトウェア拡張である。

## カスタムリソースとは
リソースは、Kubernetes API のエンドポイントで、特定の API オブジェクトのコレクションを保持する。
例えば、Pod の Kubernetes API はリソースであり、この API は、インスタンス化 (create)、属性変更 (apply)、状態取得 (get)、削除 (delete)などのコレクションを含有している。

カスタムリソースは、Kubernetes API の拡張で、
Kubernetes 本体のコードを変更せずに、
独自のリソースを容易に追加するための機能である。

カスタムリソースは、稼働しているクラスターに動的に登録され、現れたり、消えたりし、クラスター管理者はクラスター自体とは無関係にカスタムリソースを更新できる。
一度、カスタムリソースがインストールされると、ユーザーは kubectl を使い、Pod と同様に、オブジェクトを作成、アクセスすることが可能である。

## カスタムコントローラーとは
カスタムリソースは、単純に構造化データを格納、取り出す機能を提供する。カスタムリソースをカスタムコントローラーと組み合わせることで、インスタンス化、属性変更、状態取得等が可能となり、カスタムリソースは真の[宣言的 API](https://kubernetes.io/ja/docs/concepts/extend-kubernetes/api-extension/custom-resources/#%E5%AE%A3%E8%A8%80%E7%9A%84api) を提供する。

宣言的 API は、リソースのあるべき状態を宣言することを可能にし、Kubernetes オブジェクトの現在の状態を、あるべき状態に同期し続けるように動く。例えば、ユーザーが「コンテナは3つ起動されていること」という宣言を行えば、その宣言に従って Kubernetes が 3 つのコンテナを起動する。
宣言的 API の対義語は 命令的 API と呼ばれる。これはアプリケーションに対し、具体的な処理内容を命令することで順次実行させることを指す。

稼働しているクラスターのライフサイクルとは無関係に、カスタムコントローラーをデプロイ、更新することが可能である。
カスタムコントローラーはあらゆるリソースと連携できるが、
カスタムリソースと組み合わせると特に効果を発揮する。
カスタムリソースとカスタムコントローラーを組み合わせて使用することをオペレーターパターンと呼ぶ。

## カスタムリソース・カスタムコントローラーは何故必要なのか
Web アプリケーション、モバイルバックエンド、API サービスなどのステートレスアプリケーションは、Kubernetes の Deployment 等で管理・スケーリングできる。
これらのアプリケーションの運用方法について知識を追加する必要はない。

一方、データベースや監視システムなどのステートフルアプリケーションの場合は、
Kubernetes にはないドメイン固有の知識を追加する必要がある。
このようなアプリケーションをスケーリング、アップグレード、再構成するには、運用知識が必要である。

Kubernetes Operator はこの固有のドメイン知識を
Kubernetes 拡張として導入し、
アプリケーションのライフサイクルを管理して自動化できるようにする。

## CustomResourceDefinition と Operator

Kubernetes では独自のリソースを容易に追加して、Kubernetes を拡張できるように作られている。



